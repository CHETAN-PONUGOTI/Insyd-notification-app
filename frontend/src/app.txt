// src/App.js
import React, { useState, useEffect } from 'react';
import axios from 'axios';
import NotificationList from './components/NotificationList';
import './App.css';

const API_URL = 'http://localhost:5000/api';
const MOCK_USER_ID = 'user_123'; // Matches the backend logic

function App() {
  const [notifications, setNotifications] = useState([]);
  const [loading, setLoading] = useState(true);
  const [error, setError] = useState(null);

  const fetchNotifications = async () => {
    try {
      const response = await axios.get(`${API_URL}/notifications/${MOCK_USER_ID}`);
      setNotifications(response.data.notifications);
      setError(null);
    } catch (err) {
      setError('Failed to fetch notifications.');
      console.error(err);
    } finally {
      setLoading(false);
    }
  };

  // Polling mechanism to fetch notifications every 5 seconds
  useEffect(() => {
    fetchNotifications(); // Initial fetch
    const intervalId = setInterval(fetchNotifications, 5000);
    return () => clearInterval(intervalId); // Cleanup on component unmount
  }, []);

  const handleTriggerEvent = async (eventType) => {
    try {
      await axios.post(`${API_URL}/events`, {
        type: eventType,
        sourceUserId: 'user_456',
        targetUserId: MOCK_USER_ID,
        data: {
          postTitle: "New Architecture Project"
        }
      });
      alert('Event sent successfully! Polling will fetch the new notification shortly.');
    } catch (err) {
      alert('Error triggering event.');
      console.error(err);
    }
  };

  return (
    <div className="App">
      <h1>Insyd Notification System POC</h1>
      <button onClick={() => handleTriggerEvent('like_post')}>
        Trigger 'Like Post' Event
      </button>

      <h2>Your Notifications</h2>
      {loading && <p>Loading notifications...</p>}
      {error && <p className="error">{error}</p>}
      {!loading && !error && <NotificationList notifications={notifications} />}
    </div>
  );
}

export default App;



// src/App.js
import React, { useState, useEffect, useCallback } from 'react';
import axios from 'axios';
import NotificationList from './components/NotificationList';
import './App.css';

const MOCK_USERS = Array.from({ length: 100 }, (_, i) => `user_${i + 1}`);
const API_URL = 'http://localhost:5000/api';

const POST_TITLES = [
  "New Urban Design Project: The Green City Initiative",
  "Reviving Historical Architecture: A Case Study",
  "Sustainable Housing: Future of Residential Design",
  "The Role of AI in Modern Architecture",
  "A Glimpse into the World of Frank Lloyd Wright",
  "Innovative Bridge Designs of the 21st Century",
  "Redefining Public Spaces: A Community-Led Approach",
  "Behind the Scenes of the Burj Khalifa Construction"
];

const events = ["Like_user", "Follower_user", "Comment_user", "see_profile"]

function App() {
  const [userId, setUserId] = useState(MOCK_USERS[0]);
  const [notifications, setNotifications] = useState([]);
  const [loading, setLoading] = useState(true);
  const [error, setError] = useState();

  const fetchNotifications = useCallback(async () => {
    if (!userId) return;
    try {
      const response = await axios.get(`${API_URL}/notifications/${userId}`);
      setNotifications(response.data.notifications);
      setError(null);
    } catch (err) {
      setError('Failed to fetch notifications.');
      console.error(err);
    } finally {
      setLoading(false);
    }
  }, [userId]); // The useCallback dependency array

  useEffect(() => {
    fetchNotifications();
    const intervalId = setInterval(fetchNotifications, 5000);
    return () => clearInterval(intervalId);
  }, [fetchNotifications]); // The useEffect dependency array

  const randomPostTitle = POST_TITLES[Math.floor(Math.random() * POST_TITLES.length)];

  const handleTriggerEvent = async (eventType) => {
    try {
      await axios.post(`${API_URL}/events`, {
        type: eventType,
        sourceUserId: MOCK_USERS[Math.floor(Math.random() * 100)],
        targetUserId: userId,
        data: {
          postTitle: randomPostTitle
        }
      });
      alert('Event sent successfully!');
    } catch (err) {
      alert('Error triggering event.');
      console.error(err);
    }
  };

  return (
    <div className="App">
      <div class="header">
        <img src="https://iili.io/K9ihHOX.jpg" alt="insyd_image" class="img" />
        <div className="user-selector">
          <label htmlFor="user-select" class="user-select">Select User: </label>
          <select id="user-select" value={userId} onChange={(e) => setUserId(e.target.value)}>
            {MOCK_USERS.map(u => (
              <option key={u} value={u}>{u}</option>
            ))}
          </select>
        </div>
      </div>
      <button onClick={() => handleTriggerEvent('like_post')}>
        Trigger 'Like Post' Event for Current User
      </button>
      <h2>Notifications for {userId}</h2>
      {loading && <p>Loading notifications...</p>}
      {error && <p className="error">{error}</p>}
      {!loading && !error && <NotificationList notifications={notifications} />}
    </div>
  );
}

export default App;